FROM python:3.10-slim

WORKDIR /app

# CÃ i Ä‘áº·t cÃ¡c thÆ° viá»‡n há»‡ thá»‘ng cáº§n thiáº¿t
RUN apt-get update && apt-get install -y \
    gcc \
    libpq-dev \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements vÃ  cÃ i Ä‘áº·t
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy toÃ n bá»™ mÃ£ nguá»“n
COPY . .

# Expose port
EXPOSE 5001

# Táº¡o script Ä‘á»ƒ cháº¡y migrations vÃ  khá»Ÿi Ä‘á»™ng server
RUN echo '#!/bin/bash\n\
    echo "ðŸ”„ Waiting for database..."\n\
    sleep 10\n\
    echo "ðŸ”„ Running migrations..."\n\
    python manage.py makemigrations\n\
    python manage.py migrate\n\
    echo "ðŸš€ Starting server..."\n\
    exec python manage.py runserver 0.0.0.0:5001' > /start.sh && chmod +x /start.sh

# Cháº¡y script khá»Ÿi Ä‘á»™ng
CMD ["/start.sh"]
